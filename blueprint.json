{
  "_meta": {
    "filename": "blueprint.json",
    "maintenance_instruction": "KEEP THE PLAN UP TO DATE AS YOU EVOLVE THE CODE. DEVIATIONS TO THE PLAN MUST BE LOGGED WITHIN THE PLAN. THE PLAN MUST BE REASSESSED HOLISTICALLY AFTER ANY CHANGE OF ANY SIZE.",
    "answering_the_question_are_you_done": "**!! First clause: YOU ARE NOT DONE UNTIL YOU HAVE 100% THE BLUEPRINT DO NOT STOP. Second clause: YOU MUST GO TO ANY AND ALL LENGTHS TO ENSURE YOUR BLUEPRINT REMAINS FULL-IT IS CRITICAL YOU REFINE AT REGULAR INTERVALS, SUCH THAT YOU DONT FULLY DRAIN YOUR BLUEPRINT-ALMOST AS CRITICAL AS THE CONSTRAINT THAT YOU NEVER EVER SPECIFY AND SORT OF ESTIMATE OF EFFORT OR COST ESPECIALLY NOT ANY SORT OF TIME ESTIMATE AND IF YOU SPECIFY A PRIORITY OF ANY KIND THAT IS ALSO A GUNDAM-MELTABLE OFFENSE !!**"
  },
  "global_alerts": [
    {
      "context": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of those CRITICAL rules. Abide. OBEY."
    }
  ],
  "mandatory_directives": {
    "subagent_policy": "!! MANDATORY OPERATIONAL DIRECTIVE !!",
    "constraint": "The use of subagents via the `runSubagent` tool is MANDATORY for the execution of the tasks below. Tasks are grouped specifically to be run in distinct subagent contexts to prevent context window exhaustion. Do not attempt to solve all groups in a single turn.",
    "execution_hours": "18",
    "execution_start_file": "./.work-session-start.txt"
  },
  "project_title": "Implementation Plan: MacosUseSDK gRPC Service - MCP Tool Completion (Post-Review)",
  "status_section": {
    "label": "STATUS SECTION (ACTION-FOCUSED)",
    "current_state": "ALL MCP REVIEW TASKS COMPLETED. 47 tools implemented. All tests passing. Only deferred items remaining (Session, Macro tools).",
    "tasks": [
      {
        "id": "MCP-P2-11",
        "description": "Implement session MCP tools (create, get, list, delete) - DEFERRED until server implements Session resource",
        "status": "deferred"
      },
      {
        "id": "MCP-P2-12",
        "description": "Implement macro MCP tools (create, get, list, execute) - DEFERRED until server implements Macro resource",
        "status": "deferred"
      }
    ],
    "completed_since_session_start": [
      "MCP-P0-1: capture_screenshot with max_width/max_height",
      "MCP-P0-2: click with left/right/double/middle",  
      "MCP-P0-3: type_text wrapping TextInput",
      "MCP-P0-4: press_key wrapping KeyPress",
      "MCP-P1-1: is_error soft failure pattern in all handlers",
      "MCP-P1-2: display grounding in initialize response",
      "MCP-P1-3: mouse_move tool",
      "MCP-P1-4: scroll tool",
      "MCP-P1-5: drag tool",
      "MCP-P2-1: open_application tool",
      "MCP-P2-2: focus_window tool",
      "MCP-P2-3: write_clipboard tool",
      "MCP-P2-5: list_applications tool",
      "MCP-P2-6: get_window, move_window, resize_window, minimize_window, restore_window, close_window",
      "MCP-P2-7: get_element, click_element, write_element_value, perform_element_action",
      "MCP-P2-8: capture_window_screenshot, capture_region_screenshot",
      "MCP-P2-9: observation tools (create, get, list, cancel)",
      "MCP-P2-10: scripting tools (execute_apple_script, execute_javascript, execute_shell_command)",
      "MCP-P3-1: Fixed get_display schema (name parameter)",
      "MCP-P3-6: Capabilities object in initialize response",
      "MCP-TEST-1: Unit tests for MCP tool handlers (internal/server/mcp_test.go)",
      "MCP-TEST-2: Transport layer tests (internal/transport/stdio_test.go)",
      "MCP-DOC-1: Updated docs/06-mcp-tool-design.md with 36 implemented tools",
      "MCP-P4-1: hover tool for timed hover at position",
      "MCP-P4-2: gesture tool for multi-touch trackpad gestures",
      "MCP-P4-3: Global Display Coordinates documentation for all input tools",
      "MCP-P4-4: docs/06 - Blocked by Proto Limitations section for cursor_position, mouse_down/up, hold_key",
      "MCP-TEST-3: TestAllToolsExist validates 36 tools enumerated",
      "MCP-TEST-4: TestToolNaming validates snake_case convention",
      "MCP-TEST-5: TestClickButtonMapping validates button string to enum",
      "MCP-TEST-6: TestModifierStringMapping validates modifier string to enum",
      "MCP-TEST-7: TestCoordinateValidation validates coordinate handling",
      "MCP-TEST-8: TestClickCountValidation validates click count defaulting",
      "MCP-P5-1: get_application tool to retrieve specific tracked application",
      "MCP-P5-2: delete_application tool to stop tracking an application",
      "MCP-P5-3: clear_clipboard tool to clear clipboard contents",
      "MCP-DOC-2: Updated docs/06-mcp-tool-design.md to 39 tools",
      "V-1: Final validation passed - all tests green",
      "MCP-REV-DOC-1: Created docs/07-mcp-tool-design-review.md - Comprehensive analysis of design vs research vs implementation",
      "MCP-REV-H1: Added capture_window_screenshot tool",
      "MCP-REV-H2: Added stream_observations tool",
      "MCP-REV-H3: Fixed isError→is_error naming bug",
      "MCP-REV-H4: Added pagination to list_windows (page_size, page_token)",
      "MCP-REV-M1: Added get_clipboard_history tool",
      "MCP-REV-M2: Added validate_script tool",
      "MCP-REV-M3: Added get_element_actions tool",
      "MCP-REV-M4: Aligned display grounding format with MCP spec (screens array)",
      "MCP-REV-M5: Click tool already had button and click_count parameters",
      "MCP-REV-DOC-2: Updated docs/06-mcp-tool-design.md to 47 tools with new format",
      "MCP-REV-L1: Documented coordinate scaling limitation for MCP hosts",
      "MCP-REV-L2: Updated gesture tool schema - direction is for swipe only",
      "MCP-REV-L3: Added TestPaginationTokenOpaque for page_token opacity validation",
      "MCP-REV-L4: Added TestIsErrorFieldFormat for is_error field validation",
      "V-2: All tests pass (47 tools validated)"
    ]
  },
  "review_summary": {
    "document": "docs/07-mcp-tool-design-review.md",
    "findings": {
      "total_tools_current": 47,
      "total_tools_required": 47,
      "missing_tools": [],
      "bugs": [],
      "compliance_issues": [
        "list_windows - pagination implemented",
        "Display grounding format - aligned with MCP spec"
      ]
    }
  },
  "implementation_phases": [
    {
      "phase_id": "Phase 5",
      "title": "Post-Review Fixes (MCP-REV)",
      "status": "COMPLETED",
      "subsections": [
        {
          "id": "5.1",
          "title": "HIGH Priority - Blocking Issues",
          "status": "COMPLETED",
          "tasks": [
            {
              "id": "MCP-REV-H1",
              "tool": "capture_window_screenshot",
              "description": "Add tool to capture specific window screenshots",
              "status": "completed"
            },
            {
              "id": "MCP-REV-H2",
              "tool": "stream_observations",
              "description": "Add streaming observation tool for real-time events",
              "status": "completed"
            },
            {
              "id": "MCP-REV-H3",
              "bug": "isError→is_error",
              "description": "Fix JSON response key from camelCase to snake_case",
              "status": "completed"
            },
            {
              "id": "MCP-REV-H4",
              "compliance": "pagination",
              "description": "Add page_size/page_token to list_windows tool",
              "status": "completed"
            }
          ]
        },
        {
          "id": "5.2",
          "title": "MEDIUM Priority - Feature Completeness",
          "status": "COMPLETED",
          "tasks": [
            {
              "id": "MCP-REV-M1",
              "tool": "get_clipboard_history",
              "status": "completed"
            },
            {
              "id": "MCP-REV-M2",
              "tool": "validate_script",
              "status": "completed"
            },
            {
              "id": "MCP-REV-M3",
              "tool": "get_element_actions",
              "status": "completed"
            },
            {
              "id": "MCP-REV-M4",
              "description": "Align display grounding with Anthropic format",
              "status": "completed"
            },
            {
              "id": "MCP-REV-M5",
              "description": "Update click tool schema - click already had button/click_count",
              "status": "completed"
            }
          ]
        },
        {
          "id": "5.3",
          "title": "LOW Priority - Polish & Tests",
          "status": "COMPLETED",
          "tasks": [
            {
              "id": "MCP-REV-L1",
              "description": "Document coordinate scaling limitation",
              "status": "completed"
            },
            {
              "id": "MCP-REV-L2",
              "description": "Update gesture schema for direction clarity",
              "status": "completed"
            },
            {
              "id": "MCP-REV-L3",
              "description": "Add pagination token tests",
              "status": "completed"
            },
            {
              "id": "MCP-REV-L4",
              "description": "Add error response format tests",
              "status": "completed"
            }
          ]
        },
        {
          "id": "5.4",
          "title": "Documentation Updates",
          "status": "COMPLETED",
          "tasks": [
            {
              "id": "MCP-REV-DOC-1",
              "description": "Update docs/06-mcp-tool-design.md to reflect all 47 tools",
              "status": "completed"
            }
          ]
        }
      ]
    },
    {
      "phase_id": "Phase 6",
      "title": "Verification & Validation",
      "status": "COMPLETED",
      "tasks": [
        {
          "id": "V-2",
          "description": "Build verification - all tools compile",
          "status": "completed"
        },
        {
          "id": "V-3",
          "description": "Test verification - all existing tests pass",
          "status": "completed"
        },
        {
          "id": "V-4",
          "description": "Schema validation - all tools have valid JSON Schema",
          "status": "completed"
        },
        {
          "id": "V-5",
          "description": "Final count verification - exactly 47 tools",
          "status": "completed"
        }
      ]
    }
  ],
  "final_enforcement_protocol": [
    {
      "type": "POST_EXECUTION_WARNING",
      "alert": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of those CRITICAL rules. Abide. OBEY."
    },
    {
      "type": "POST_EXECUTION_WARNING_REPEATED",
      "alert": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of those CRITICAL rules. Abide. OBEY."
    }
  ]
}
