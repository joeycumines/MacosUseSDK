.DEFAULT_GOAL := all
ROOT_MAKEFILE := $(abspath $(lastword $(MAKEFILE_LIST)))
PROJECT_ROOT := $(patsubst %/,%,$(dir $(ROOT_MAKEFILE)))
GO_TARGET_PREFIX := go.
SWIFT_TARGET_PREFIX := swift.
GO_MODULE_SLUGS_NO_PACKAGES ?= hack.google-api-linter
GO_MODULE_SLUGS_NO_UPDATE ?= hack.google-api-linter

-include $(PROJECT_ROOT)/config.mk
include $(PROJECT_ROOT)/make/go.mk
include $(PROJECT_ROOT)/make/swift.mk
include $(PROJECT_ROOT)/make/buf.mk

##@ Core Targets

.PHONY: all
all: go.all swift.all google-api-linter ## Run a full build of the project.

.PHONY: clean
clean: go.clean swift.clean ## Tidy up local files generated by the build.

.PHONY: fmt
fmt: go.fmt buf.format swift.fmt ## Format all source files.

.PHONY: generate
generate: buf.generate go.generate ## Generate all code.

.PHONY: gen
gen: generate ## Alias for 'generate'.

.PHONY: update
update: buf.update go.update ## Update all dependencies.

.PHONY: google-api-linter
google-api-linter: ## Lint the proto files.
	hack/google-api-linter.sh

##@ -- End of root Makefile --
